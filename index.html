<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>U-Turn Drag â€“ Stable Baseline</title>
<style>
html,body{margin:0;height:100%;background:#0b0f14;overflow:hidden}
canvas{width:100%;height:100%;display:block}
#hud{position:fixed;left:12px;top:12px;color:#fff;font:14px system-ui;background:#0008;padding:10px;border-radius:10px}
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="hud">2020 Mustang GT<br>W/S throttle & brake<br>Mouse steer</div>
<script>
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const car={mass:1650,wheelbase:2.72,a:1.25,b:1.47,h:0.52,mu:1.25,Cf:140000,Cr:130000,engine:9000,brake:1.1};
let x=0,y=0,psi=Math.PI/2,vx=0,vy=0,r=0,delta=0,th=0,br=0;
const c=document.getElementById("c"),ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}resize();onresize=resize;
let steer=0;
onmousemove=e=>steer=clamp((e.clientX/innerWidth-.5)*2,-1,1);
onkeydown=e=>{if(e.code==="KeyW")th=1;if(e.code==="KeyS")br=1}
onkeyup=e=>{if(e.code==="KeyW")th=0;if(e.code==="KeyS")br=0}

function step(dt){
 delta+=((steer*.7)-delta)*6*dt;
 const Fzf=car.mass*9.81*(car.b/car.wheelbase);
 const Fzr=car.mass*9.81*(car.a/car.wheelbase);
 const vxf=vx,vyf=vy+car.a*r,vxr=vx,vyr=vy-car.b*r;
 const af=Math.atan2(vyf,Math.max(.5,vxf))-delta;
 const ar=Math.atan2(vyr,Math.max(.5,vxr));
 let FyF=-car.Cf*Math.tanh(af*1.6);
 let FyR=-car.Cr*Math.tanh(ar*1.6);
 FyF=clamp(FyF,-car.mu*Fzf,car.mu*Fzf);
 FyR=clamp(FyR,-car.mu*Fzr,car.mu*Fzr);
 const Fx=(th*car.engine)-(br*car.mass*9.81*car.brake);
 const ax=Fx/car.mass+r*vy,ay=(FyF+FyR)/car.mass-r*vx;
 vx+=ax*dt;vy+=ay*dt;
 r+=(car.a*FyF-car.b*FyR)/(0.25*car.mass*car.wheelbase**2)*dt;
 psi+=r*dt;
 x+=(Math.cos(psi)*vx-Math.sin(psi)*vy)*dt;
 y+=(Math.sin(psi)*vx+Math.cos(psi)*vy)*dt;
}
function draw(){
 ctx.fillStyle="#0b0f14";ctx.fillRect(0,0,c.width,c.height);
 ctx.save();ctx.translate(c.width/2,c.height*0.6);ctx.scale(1,0.7);
 ctx.rotate(psi);ctx.fillStyle="#2c78ff";ctx.fillRect(-60,-25,120,50);
 ctx.restore();
}
let t=performance.now();
function loop(n){
 const dt=Math.min(.03,(n-t)/1000);t=n;
 step(dt);draw();requestAnimationFrame(loop)
}
loop(t);
</script>
</body>
</html>
